# Админ-панель

## Описание

Административная панель для управления пользователями и мониторинга статистики системы тестирования.

## Функции

### Главная панель (`/admin/dashboard`)
- **Статистика**:
  - Общее количество пользователей
  - Пользователи с доступом к тестированию
  - Количество пройденных тестов
  - Количество тестов в процессе
  - Общая выручка
- **Последние регистрации**: список последних 10 зарегистрированных пользователей
- **Последние завершенные тесты**: список последних 10 завершенных тестирований

### Управление пользователями (`/admin/users`)
- **Список пользователей** с пагинацией (20 на странице)
- **Фильтры**:
  - Поиск по имени или email
  - Фильтр по доступу (с доступом / без доступа)
  - Фильтр по роли (администраторы / пользователи)
- **Быстрые действия**:
  - Переключение доступа к тестированию одним кликом
  - Редактирование пользователя
  - Удаление пользователя (с подтверждением)

### Редактирование пользователя (`/admin/users/{id}/edit`)
- **Основные данные**:
  - Имя
  - Email
  - Дата рождения
  - Доступ к тестированию (checkbox)
  - Права администратора (checkbox)
  - Изменение пароля
- **Информация**:
  - ID пользователя
  - Дата регистрации
  - Последнее обновление
- **Статистика тестирования**:
  - Количество сессий
  - Завершенные тесты
  - Тесты в процессе
  - История последних 5 сессий
- **Опасная зона**: удаление пользователя

## Доступ к админке

### Выдача прав администратора

Используйте скрипт `grant-admin.php`:

```bash
php grant-admin.php user@example.com
```

### Проверка прав

Пользователь является администратором, если:
- Поле `is_admin` в базе данных установлено в `true` (1)
- Пользователь авторизован

### Вход в админку

1. Авторизуйтесь в системе
2. На главной странице нажмите кнопку "Админ-панель" (доступна только администраторам)
3. Или перейдите напрямую: `/admin/dashboard`

## Безопасность

### Middleware `IsAdmin`

Все маршруты админки защищены middleware `admin`, который проверяет:
1. Авторизован ли пользователь (`auth()->check()`)
2. Имеет ли пользователь права администратора (`auth()->user()->is_admin`)

При отсутствии прав возвращается ошибка 403 "Доступ запрещен".

### Защита от самоудаления

- Администратор не может удалить свою учетную запись
- Администратор не может изменить свои права администратора (в форме редактирования)

## Маршруты

```
GET  /admin/dashboard                     - Главная панель
GET  /admin/users                         - Список пользователей
GET  /admin/users/{id}/edit               - Редактирование пользователя
PUT  /admin/users/{id}                    - Обновление данных пользователя
POST /admin/users/{id}/toggle-access      - Переключение доступа
DELETE /admin/users/{id}                  - Удаление пользователя
```

## Структура файлов

```
app/
  Http/
    Controllers/
      Admin/
        AdminController.php              - Контроллер главной панели
        UserManagementController.php     - Контроллер управления пользователями
    Middleware/
      IsAdmin.php                        - Middleware проверки прав администратора

resources/
  views/
    layouts/
      admin.blade.php                    - Основной layout админки
    admin/
      dashboard.blade.php                - Главная панель
      users/
        index.blade.php                  - Список пользователей
        edit.blade.php                   - Редактирование пользователя

public/
  css/
    admin.css                            - Стили админки

grant-admin.php                          - Скрипт выдачи прав администратора
```

## Статистика

### Главная панель

- **Всего пользователей**: `User::count()`
- **С доступом**: `User::where('has_access', true)->count()`
- **Пройдено тестов**: `QuizSession::where('completed_at', '!=', null)->count()`
- **В процессе**: `QuizSession::whereNull('completed_at')->count()`
- **Общая выручка**: `payments.where('status', 'completed')->sum('amount')`

### Страница пользователя

- **Всего сессий**: количество записей в `quiz_sessions`
- **Завершено**: сессии с `completed_at IS NOT NULL`
- **В процессе**: сессии с `completed_at IS NULL`
- **История**: последние 5 сессий с датами и статусом

## Дизайн

### Цветовая схема

- **Основной фон**: `#f5f7fa`
- **Боковое меню**: `#1a202c`
- **Акцент**: `#4299e1` (синий)
- **Успех**: `#10b981` (зеленый)
- **Предупреждение**: `#f59e0b` (желтый)
- **Ошибка**: `#ef4444` (красный)
- **Градиент**: `#0c68f5` → `#764ba2`

### Компоненты

- **Карточки статистики**: 5 карточек с иконками и значениями
- **Таблицы**: стандартный дизайн с hover-эффектом
- **Формы**: с валидацией и сообщениями об ошибках
- **Badges**: цветные метки для статусов
- **Боковое меню**: фиксированное, с активными пунктами

## Адаптивность

- **Desktop** (>1024px): полная версия с 2 столбцами
- **Tablet** (768-1024px): 1 столбец, полное меню
- **Mobile** (<768px): сжатое меню (только иконки)

## Уведомления

- Автоматическое скрытие через 5 секунд
- Плавное исчезновение (opacity + remove)
- Типы: success (зеленый), error (красный)

## Валидация

### Редактирование пользователя

- **name**: обязательное, строка, макс. 255 символов
- **email**: обязательное, email, уникальное (кроме текущего), макс. 255
- **birthdate**: необязательное, дата, раньше сегодня
- **has_access**: boolean
- **is_admin**: boolean
- **password**: необязательное, мин. 8 символов, с подтверждением

## Следующие шаги

### Планируемые функции

1. **Аналитика**:
   - Графики регистраций по дням
   - Конверсия (регистрация → оплата → прохождение)
   - Популярные модули

2. **Управление контентом**:
   - Редактирование вопросов квиза
   - Добавление новых модулей
   - Настройка алгоритмов подсчета

3. **Финансы**:
   - Детальная статистика платежей
   - Экспорт отчетов
   - Возвраты и скидки

4. **Уведомления**:
   - Email-рассылки
   - Напоминания о незавершенных тестах
   - Системные уведомления

5. **Экспорт данных**:
   - Экспорт пользователей в CSV/Excel
   - Экспорт результатов тестирования
   - Backup базы данных
